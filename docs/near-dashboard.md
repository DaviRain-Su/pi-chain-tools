# NEAR Dashboard (Local Web)

This is a lightweight local dashboard for quick visibility into your account state while running strategies.

## What it shows (current)

- NEAR wallet balance
- Tracked FT balances (USDt / USDC.e / USDC / wNEAR)
- Burrow registration + position rows (`collateral` / `supplied` / `borrowed`)
- Yield worker status (best-effort from latest local OpenClaw session log)
- Recent execution tx list (best-effort from latest local OpenClaw session log)
- Strategy view: current stable collateral APR ranking + quick recommendation
- Action Console: command builder + optional direct execution for selected actions (requires browser confirm)
- Action history panel: success/error timeline for dashboard-triggered actions
- Yield health panel: weighted APR + collateral composition summary
- Target allocation alert: configurable USDt/USDC.e targets + deviation threshold
- Rebalance suggestion: estimate transfer amount needed to move toward target mix
- Rebalance execution draft: one-click generate/copy 3-step withdraw/swap/supply command draft
- One-click fill Action Console from latest rebalance plan (with pre-execution checklist)
- Step runner helper: build Step1/Step2/Step3 commands and feed Step2 output raw into Step3 template
- Step2 parser helper: paste swap result text and auto-extract output raw for Step3
- Action History now supports optional `step` tag for execution traceability (e.g. step1/step2/step3)
- Action History includes txHash + explorer link when parsed from execution output
- One-click transactional rebalance action (`USDt -> USDC.e`): step1 withdraw -> step2 swap -> step3 supply, with automatic rollback (resupply USDt) when step2 fails
- Idempotency/state guard: optional `runId` support, duplicate run rejection, and single active rebalance lock
- Post-execution reconciliation: compares wallet residual USDt/USDC.e after step3 and records a reconcile entry in Action History
- Execution Quality panel: success/failure/rollback/reconcile-warning counters + recent run summary
- ACP Ops panel: ACP connectivity (`/api/acp/status`) + ACP job summary (`/api/acp/jobs/summary`) + recent ACP job list (`/api/acp/jobs`) in dashboard UI
- ACP Ops now includes async submit controls (strategyId/buyer/amountRaw) and live polling for submitted async job status (`/api/acp/job/submit` + `/api/acp/jobs/:jobId`)
- ACP async worker now supports retry backoff + max attempts and dead-letter state (`status=dead-letter`) for persistent failures
- ACP Ops UI now shows dead-letter table view with error-type grouping and retryability badges, plus batch actions (retry retryable / retry selected / dismiss selected)
- ACP Ops also surfaces dismissed-queue count so archived failures do not pollute active dead-letter triage
- ACP Ops supports archive hygiene: purge dismissed jobs older than N days via confirm-protected action
- Optional auto-purge scheduler can run in-process for dismissed archive retention control
- Dashboard includes Payments panel (`/api/payments`) with status breakdown (`pending/paid/failed`) and recent payment rows
- ACP recent jobs table supports status filtering and NEAR tx explorer links when `txHash` is present
- ACP recent jobs table now also shows `strategyId` / `buyer` / `remainingUses` to trace entitlement consumption during execution
- ACP recent jobs supports local filters by `status` + `buyer` + `strategyId` for faster ops triage
- ACP recent jobs includes `only failed` quick toggle (status in `error|blocked`)
- ACP filter state (`status/buyer/strategyId/onlyFailed`) is synced to URL query params for refresh/share persistence
- ACP filter/expand preferences are also persisted to localStorage (`near-dashboard-acp-filters-v1`) for cross-link personal continuity (`acpExpandErrors` included)
- ACP filters bar includes `Copy filter link` for one-click sharing of the current triage view
- ACP filters bar includes `Reset filters` to clear `status/buyer/strategyId/onlyFailed` and restore `auto-expand errors`, then clean URL query state
- ACP recent jobs row supports click-to-expand detail view (raw job JSON, including receipt/error-related fields when present)
- Expanded detail view includes quick actions: `Copy JSON`, `Copy runId/jobId`, `Copy txHash`, and `Open explorer` (NEAR/BSC tx links)
- Expanded detail now renders structured blocks (`receipt` / `result` / `error` / `raw`) for faster troubleshooting
- Error-focused readability: when a job is `error` (or has error payload), detail blocks auto-expand and the error section is visually marked (`⚠ error`)
- Execution Quality now also includes RPC reliability counters (attempts/retries/retryRate/HTTP 429/5xx), last successful endpoint / latest error snippet, and a basic endpoint health ranking (`score`) to indicate the currently best-performing RPC
- Execution Quality includes payment webhook health counters (`accepted/idempotent/rejected`, last provider/error) for callback operations
- Adaptive RPC routing: request loop prefers currently best-scored endpoint first (based on live endpoint health stats)
- ACP integration bootstrap (Virtual Base identity + multi-chain execution preview):
  - `GET /api/acp/status` -> best-effort `acp whoami` + `acp wallet balance` JSON output
  - `POST /api/acp/route-preview` -> returns execution route plan (`targetChain=near|bsc`, `intentType`, `riskProfile`) for router wiring
  - `POST /api/acp/job/submit` (`confirm=true`) -> async enqueue ACP job and return `jobId` immediately
  - `POST /api/acp/job/execute` (`confirm=true`) -> ACP job router entrypoint; supports `dryRun` (default true) and execute mode for `intentType=rebalance` via existing chain action pipeline
    - returns normalized `receipt` (`runId/identityChain/targetChain/intentType/amountRaw/amountUsd/status/txHash?/adapterMode`)
    - enforces policy `constraints.minRebalanceUsd`
    - entitlement gate: when execute request carries `strategyId`, it must include `buyer` and `paymentId`, and pass strict checks: payment exists, status is `paid`, and `strategyId+buyer` matches payment record
    - a valid active entitlement (`remainingUses > 0`, not expired) is still required; otherwise blocked
    - execute receipts/history include payment/entitlement trace fields (`paymentId`, `entitlementSourcePaymentId`)
    - replay/idempotency guard: repeated terminal run with same `runId + paymentId` is blocked (`reason=duplicate_run`)
    - for chains still in adapter plan-only mode (e.g. current bsc path), receipt `status=planned` and `adapterMode=plan-only`
  - `GET /api/acp/jobs` -> recent ACP job history (dry-run/executed/planned/blocked/error) + async queue snapshot (includes `attemptCount/maxAttempts/nextAttemptAt/lastErrorAt`)
  - `GET /api/acp/jobs/:jobId` -> async job status/result/error by id (includes retry/dead-letter metadata)
  - `GET /api/acp/jobs/dead-letter` -> async jobs exhausted after max attempts
  - `GET /api/acp/jobs/dismissed` -> archived dismissed jobs
  - `POST /api/acp/jobs/dismissed/purge` (`confirm=true`, `olderThanDays`) -> purge archived dismissed jobs older than N days
  - `POST /api/acp/jobs/retry` (`confirm=true`, `jobId`) -> manually requeue a dead-letter/error async job
  - `POST /api/acp/jobs/retry-batch` (`confirm=true`, `jobIds[]`) -> batch requeue dead-letter/error async jobs
  - `POST /api/acp/jobs/retry-retryable` (`confirm=true`) -> requeue all currently retryable dead-letter jobs
  - `POST /api/acp/jobs/dismiss` (`confirm=true`, `jobIds[]`) -> mark dead-letter jobs as dismissed (remove from active DLQ)
  - `GET /api/acp/jobs/summary` -> status distribution + queue status breakdown + daily execution counters/limit
  - execute mode applies policy daily guard `constraints.maxDailyRebalanceRuns`
- Unified multi-chain portfolio bootstrap:
  - `GET /api/portfolio/unified` -> aggregates NEAR execution portfolio + ACP identity layer + BSC wallet/yield/market compare/protocol positions snapshot (active when `BSC_EXECUTE_RECIPIENT` is configured)
    - includes `risk.bscNormalization` summary (`status/band/maxRiskScore/staleCount/unknownCount/rows`) for Lista/Wombat normalization freshness monitoring
    - BSC protocol positions include `subtotalsUsdApprox`, `totalUsdApprox`, `health` (`status/reason/detail`), and `fetchedAt`
- Portfolio policy center (cross-chain target + constraints):
  - `GET /api/policy` -> current policy
  - `POST /api/policy` (`confirm=true`) -> patch `targetAllocation` / `constraints` / `monetization` and persist to disk
- Strategy marketplace bootstrap:
  - `GET /api/strategies` -> list strategies
  - `POST /api/strategies/validate` -> preflight validate strategy DSL without persisting
    - accepts either `dsl` object or legacy fields; returns `phase=schema|semantic|ready`
    - includes `errors[]`, `warnings[]`, and `normalized` DSL when available
    - dashboard UI now supports one-click `Validate -> Publish` flow (calls `/api/strategies` with `confirm=true` only after preflight success)
    - validation output includes simple field-level hints by parsing `field:`-prefixed errors/warnings (e.g., `risk.maxSlippageBps:`)
  - `POST /api/strategies` (`confirm=true`) -> create/update strategy metadata with Strategy DSL v1 + semantic policy validation
    - preferred: submit `dsl` object (validated against `docs/schemas/strategy-dsl.v1.schema.json` and policy semantics)
    - compatible: legacy top-level fields (`id/name/creator/priceUsd/...`) are auto-mapped into DSL v1 then validated
    - semantic checks include policy-aligned amount floor/limit (`minRebalanceUsd`, `maxDailyRebalanceRuns`), chain-intent compatibility, and execution risk warnings
  - `POST /api/strategies/purchase` (`confirm=true`) -> direct purchase path (legacy simulation) + entitlement grant (`entitlementUses`, `entitlementDays`, default 30/30)
  - `POST /api/payments/create` (`confirm=true`) -> create pending payment intent for `strategyId + buyer`
  - `POST /api/payments/confirm` (`confirm=true`) -> confirm payment status (`paid|failed`), and grant entitlement only when paid
  - `POST /api/payments/webhook` -> provider callback entry (optional signature verification via `PAYMENT_WEBHOOK_SECRET`; header `x-payment-signature`/`x-openclaw-signature`)
    - provider mapping supports `generic|ping|x402` via `?provider=...` or header `x-payment-provider`
    - event idempotency enabled by `eventId/id/event_id` de-duplication
  - `GET /api/payments` -> payment records (pending/paid/failed)
  - `GET /api/strategies/purchases` -> recent purchase receipts
  - `GET /api/strategies/entitlements?buyer=...&strategyId=...` -> entitlement snapshots (remaining uses + expiry)
- Metrics persistence: rebalance + rpc reliability metrics survive dashboard restarts via local json file (`NEAR_DASHBOARD_METRICS_PATH`)
- ACP async queue persistence: queued/running jobs are persisted and restored on restart (running jobs re-queued for safe resume)
- ACP async retry policy: exponential backoff (1s,2s,4s...) with per-job `maxAttempts` (default 3); retry now only applies to retryable failures, non-retryable failures enter `dead-letter` immediately
- Basic PnL trend proxy: tracks stable collateral total delta before/after each successful rebalance
- Multi-chain UX skeleton: draft/action-console supports `near|bsc` selector
- BSC mode supports quote+minOut planning for `rebalance_usdt_to_usdce_txn` (`chain=bsc`), and can execute in two built-in adapter modes:
  - includes stable-yield agent v1 APIs:
    - `GET /api/bsc/yield/plan` (supports `executionProtocol=venus|aave|lista|wombat`; when omitted, defaults to net-yield `recommendedProtocol`; returns `executeReadiness.blockers/recommendedProtocol` and includes `netYieldInsight`)
    - `GET /api/bsc/yield/markets` (returns Venus/Aave/Lista/Wombat read-only compare + best protocol recommendation + `sourceHealth` + `marketHealth(status/source/updatedAt/ageMs)` + `marketRiskTags` + `marketRiskScore(0-100)` + `marketRiskBand(low|medium|high)` + `aggregateRisk{avgScore,maxScore,band}` + `netYieldInsight`; includes Pancake V2 read-only quote signal and `dexQuoteCompare{bestSource,conservativeSource,spreadBps}` in `netYieldInsight.quote`; supports query `amountUsd` and `rebalanceIntervalDays`; `executionReadiness.nativeSlotImplemented` exposes per-protocol native slot status, where Lista and Wombat are `true` only when native RPC config is present (`POOL` + protocol private key)
    - `POST /api/bsc/yield/execute` (`confirm=true`, supports `executionProtocol=venus|aave|lista|wombat`; `aave` requires enable flag; `lista/wombat` support native RPC mode and command fallback)
    - `POST /api/bsc/yield/worker/start` (`confirm=true`, `dryRun` default true)
    - `POST /api/bsc/yield/worker/stop` (`confirm=true`)
    - `GET /api/bsc/yield/worker/status`
  - `BSC_EXECUTE_MODE=native` (recommended): uses in-process native RPC signer path with `BSC_EXECUTE_PRIVATE_KEY`
  - `BSC_EXECUTE_MODE=command`: uses `BSC_EXECUTE_COMMAND` template placeholders `{amountInRaw} {minAmountOutRaw} {tokenIn} {tokenOut} {router} {rpcUrl} {chainId} {runId}`
  - `BSC_EXECUTE_MODE=auto` (default): prefer native when key exists, otherwise command
  - when configured, response returns `mode=execute` with `txHash` and BscScan link; otherwise explicit `mode=plan-only`
  - quote now supports dual-source validation (Dexscreener + onchain router), returns conservative quote, and enforces divergence guard
  - native mode includes post-trade reconciliation fields (`tokenInDeltaRaw`, `tokenOutDeltaRaw`, `reconcileOk`, `minAmountOutRaw`) in receipt
  - execute failures are normalized as `BSC_EXECUTE_FAILED retryable=true|false ...` for async retry/dead-letter classification
  - Aave/Lista/Wombat post-action failures are normalized as `BSC_*_POST_ACTION_FAILED ...` and recorded into ACP job history / DLQ type grouping
  - `POST /api/bsc/yield/execute` now returns `postActionArtifact` (protocol-agnostic `bsc_post_action_supply@v1`) and `postActionReconciliation` (routed via artifact type/version + protocol adapter registry: `aave|lista|wombat`), and persists both in ACP job history for adapter-agnostic reconciliation
  - post-swap supply execution is also unified via a protocol executor registry (`aave|lista|wombat`), reducing per-protocol branching in the execute path
  - artifact path includes runtime validator (`validateBscPostActionArtifactV1`) and schema artifact (`docs/schemas/bsc-post-action-supply-artifact.v1.schema.json`) to prevent format drift
  - ACP UI now surfaces `executionProtocol` + `postActionStatus` columns and tags dead-letter phase (`main` vs `bsc-aave-post`)
  - ACP filters include phase selectors (`all|main|bsc-aave-post`) for jobs and dead-letter triage
  - dead-letter supports type filter + clickable byType chips for one-click incident narrowing
  - dead-letter quick presets: `Aave post failures`, `Main failures`, `Clear presets`
  - ACP ops header includes clickable failure heatmap summary (`phase/type:count`) with time window selector (`1h|24h|7d`) and can jump directly to dead-letter phase/type filters
  - failure heatmap now embeds normalization-risk chips (`norm/<protocol>:<freshness>@<age>(<source>)`) for quick Lista/Wombat source triage
  - Yield Health card now includes BSC protocol position health/subtotals (`Aave`, `Venus`, `total`, `fetchedAt`)
  - Yield Health card also shows Aave execute readiness from `/api/bsc/yield/plan` (`canExecute/reason/aaveMode/blockers/recommendedProtocol/fixPack`), highlights `primary` blocker + `fix-order`, and provides one-click `Copy blockers` + `Copy env snippet` + `Copy full fix pack` (grouped, annotated `.env` template)
  - Yield Health card now surfaces portfolio-level aggregate risk (`band/avg/max`) from `/api/bsc/yield/markets.aggregateRisk`
  - Yield Health card also surfaces BSC market health summary (`venus/aave/lista/wombat`) from `/api/bsc/yield/markets.marketHealth` with status coloring (`fresh/stale/unknown`) and hover details (`source/updatedAt/age`)
  - BSC protocol block shows Lista/Wombat normalization sources (`api/env/env-fallback`) with hover details (updatedAt + usdc/usdt rates)
- Optional alert push on rollback/failure/reconcile-warning:
  - `NEAR_REBAL_ALERT_WEBHOOK_URL`
  - `NEAR_REBAL_ALERT_TELEGRAM_BOT_TOKEN`
  - `NEAR_REBAL_ALERT_TELEGRAM_CHAT_ID`
  - `NEAR_REBAL_ALERT_SUCCESS=true` (send success/info alerts)
  - `NEAR_REBAL_ALERT_DEDUPE_MS=300000` (same-alert dedupe window)
  - `NEAR_REBAL_ALERT_BSC_NORMALIZATION=true` (enable normalization risk alerts)
  - `NEAR_REBAL_ALERT_BSC_NORMALIZATION_MIN_BAND=medium` (trigger threshold: `low|medium|high`)
  - alert message includes compact `top=` rows (protocol freshness/source) and a runbook pointer (`docs/near-dashboard.md#alerts`)
- Dashboard alert test endpoint/button:
  - API: `POST /api/alerts/test` (requires `confirm=true`)
  - UI: `Action Console -> Test alerts`
- CI resilient failure-signature telemetry:
  - `scripts/ci-resilient.mjs` appends JSONL records to `apps/dashboard/data/ci-signatures.jsonl` (override via `CI_SIGNATURES_JSONL_PATH`)
  - read-only API: `GET /api/ops/ci-signatures?limit=50` (returns newest-first rows)
  - Dashboard `CI Failure Signatures` card summarizes latest run status and top recent `checkFailureKind` clusters
  - Includes `Copy failure clusters` action and recent-row table (time/status/failure kind/python/biome/test-retry)
  - Includes `Auto action` hint derived from latest `checkFailureKind` for faster ops response
- deBridge Reliability card sharing ops:
  - `Copy share link` includes `debridgeWindow` + `debridgeAdvancedOpen` query state for reproducible views
  - `Copy share markdown` copies one-line markdown link
  - `Copy markdown + summary` copies markdown link + current reliability headline for incident handoff
- Monad Agent profile/discovery + delegation/name mapping v1.4 scaffold:
  - `GET /api/monad/agent/profile` -> self-describing profile (`schema`, deterministic identity, `a2aEndpoint`, links, delegation gate, name mapping, morpho strategy summary)
  - `GET /api/monad/agent/identity` -> deterministic `agentId` + metadata + registration/delegation/name snapshots
  - `POST /api/monad/agent/identity/register` (`confirm=true`) -> explicit-gate identity registration artifact/history emission (`mode=mock|simulated-chain`)
  - `POST /api/monad/agent/name/register` (`confirm=true`) -> ENS-style alias scaffold (stateful local registry, artifact/history/blockers/hints/fixPack)
  - `POST /api/monad/agent/name/update` (`confirm=true`) -> alias repoint/update with explicit blockers/fix pack when invalid
  - `POST /api/monad/agent/delegation/prepare` -> non-custodial EIP-712-style delegation payload (`domain/types/message/digest`)
  - `POST /api/monad/agent/delegation/submit` (`confirm=true`) -> verifier-gated delegation intake (`blockers/hints/fixPack` when invalid)
  - `POST /api/monad/agent/delegation/revoke` (`confirm=true`) -> revocation path by `delegationId`
  - delegation policy bridge: worker and execute endpoint check delegation gate before live execution and emit blocked events/reasons (`monad_morpho_worker_delegation_gate`)
  - dashboard v1.4 card: profile + name mapping + status badges + copy profile JSON + alias register/update controls
  - local persistence: `MONAD_AGENT_STATE_PATH` (`apps/dashboard/data/monad-agent-state.json` by default)
- Monad Morpho Earn v1.2 (advanced polish):
  - `GET /api/monad/morpho/earn/readiness` -> execute gate aggregation + risk controls (`canExecute/blockers/hints/fixPack/riskControls`)
  - `POST /api/monad/morpho/earn/plan` -> pre-execute plan/readiness evaluation for amount (`readiness.blockers/hints/fixPack`)
  - `GET /api/monad/morpho/earn/markets` -> vault discovery snapshot (`vault/asset/APY/TVL/risk` + optional user shares) + strategy score/allocation summary
    - SDK path switch: `MONAD_MORPHO_USE_SDK=true` routes through `apps/dashboard/monad-morpho-sdk.mjs`
    - response includes `dataSource`, `sdk`, `warnings`; SDK read failure auto-falls back to native path with explicit warning
  - `GET /api/monad/morpho/earn/strategy` -> explainable scorer across vaults (`apy/liquidity/risk` factors + allocation recommendation)
    - strategy input normalization is enforced in SDK mode (`apyBps/tvlRaw/liquidityRaw/risk.score`) before scorer
  - `GET /api/monad/morpho/earn/rewards` -> SDK-first rewards read when `MONAD_MORPHO_USE_SDK=true` (normalized `campaign/token/claimable` rows); SDK read failure auto-falls back to native env snapshot with warning `morpho_sdk_rewards_fetch_failed_fallback_to_native`
  - `POST /api/monad/morpho/earn/rewards/claim` (`confirm=true`) -> SDK claim-request builder first when SDK mode is on; if builder fails, command-mode fallback remains available with warning `morpho_sdk_rewards_claim_build_failed_fallback_to_native`; response includes `txHash`, `executionArtifact`, `executionReconciliation`, and writes actionHistory + metrics consistently
  - `POST /api/monad/morpho/earn/execute` (`confirm=true`) -> native RPC wallet deposit path (approve + deposit) with normalized error (`error/retryable/category/message`) and `executionArtifact/executionReconciliation`
  - `POST /api/monad/morpho/worker/start|stop` + `GET /api/monad/morpho/worker/status` -> dry-run-first auto-rebalance worker control with interval guardrails
  - `npm run monad:morpho:replay` -> deterministic replay/pressure-test pack, writes `apps/dashboard/data/monad-morpho-replay-trend.json`
  - execution history writes to dashboard `actionHistory` with `action=monad_morpho_earn_execute`, including `runId/txHash/reconciliation`; Monad card shows recent execute trend/error summary + one-click incident copy
- deBridge MCP readiness (cross-chain integration hook):
  - `GET /api/crosschain/debridge/readiness` (returns `enabled/commandConfigured/executeEnabled/executeCommandConfigured/executeRetry/canExecute/blockers/hints`)
  - `GET /api/ops/debridge-execute-metrics?limit=30` (returns deBridge execute reliability telemetry: totals/retryRecovered/recent)
  - `POST /api/crosschain/debridge/plan` (returns `canQuote/canExecute/blockers/executeBlockers/hints/fixPack` + `next=/api/crosschain/debridge/quote`)
  - `POST /api/crosschain/debridge/quote` (dry-run quote bridge; requires `originChain/destinationChain/tokenIn/tokenOut/amount`; returns `mode=quote|blocked` + `quote/rawOutput`)
  - `POST /api/crosschain/debridge/execute` (`confirm=true` required; gated by `DEBRIDGE_MCP_EXECUTE_ENABLED` + execute command; returns `executionArtifact/executionReconciliation`)
  - execute 路径包含 runtime validator：artifact/reconciliation 不合法会返回 `debridge_execution_artifact_invalid` 或 `debridge_execution_reconciliation_invalid`
  - execute 失败错误会按类型归一化（`error` + `retryable` + `category`），例如 timeout/rate_limit/network/funds/request/auth/unknown
  - config: `crosschain.debridge.enabled|command|executeEnabled|executeCommand|timeoutMs|executeRetry.maxAttempts|executeRetry.backoffMs` (`DEBRIDGE_MCP_ENABLED|DEBRIDGE_MCP_COMMAND|DEBRIDGE_MCP_EXECUTE_ENABLED|DEBRIDGE_MCP_EXECUTE_COMMAND|DEBRIDGE_MCP_TIMEOUT_MS|DEBRIDGE_MCP_EXECUTE_RETRY_MAX_ATTEMPTS|DEBRIDGE_MCP_EXECUTE_RETRY_BACKOFF_MS`)
  - command placeholders (if used in command template): `{originChain} {destinationChain} {tokenIn} {tokenOut} {amount} {recipient} {account}`
- Rebalance risk guards (env-tunable): max amount, min quote out, max slippage, cooldown, and daily execution cap (`NEAR_REBAL_*`)
  - `NEAR_REBAL_MAX_AMOUNT_RAW` (default `5000000`)
  - `NEAR_REBAL_MIN_QUOTE_OUT_RAW` (default `500000`)
  - `NEAR_REBAL_MAX_SLIPPAGE_BPS` (default `100`)
  - `NEAR_REBAL_MIN_EFFECTIVE_RATE` (default `0.5`, blocks poor quote quality)
  - `NEAR_REBAL_COOLDOWN_SECONDS` (default `120`)
  - `NEAR_REBAL_DAILY_MAX` (default `6`)
- CSV export for latest snapshot
- Best-effort USD estimates from NEAR Intents token feed

## Start

From repository root:

```bash
npm run dashboard:start
```

Open:

- `http://127.0.0.1:4173`

## Unified dashboard config (recommended)

The dashboard now supports a single JSON config file for non-sensitive settings:

- Default path: `apps/dashboard/config/dashboard.config.json`
- Example template: `apps/dashboard/config/dashboard.config.example.json`
- Override path: `NEAR_DASHBOARD_CONFIG_PATH=/abs/path/to/dashboard.config.json`
- Precedence: `env > config file > built-in defaults`
- Quick start: copy example, edit values, keep secrets in `.env`

Keep secrets in `.env` (or your secret manager), for example:
`*_PRIVATE_KEY`, `PAYMENT_WEBHOOK_SECRET`, telegram bot token, etc.

Common mapping examples:
- `near.accountId` ↔ `NEAR_ACCOUNT_ID`
- `near.rpcUrls` ↔ `NEAR_RPC_URLS`
- `server.port` ↔ `NEAR_DASHBOARD_PORT`
- `bsc.execute.enabled` ↔ `BSC_EXECUTE_ENABLED`
- `bsc.yield.minAprDeltaBps` ↔ `BSC_YIELD_MIN_APR_DELTA_BPS`
- `bsc.aave.enabled` ↔ `BSC_AAVE_EXECUTE_ENABLED`
- `bsc.lista.enabled` ↔ `BSC_LISTA_EXECUTE_ENABLED`
- `bsc.lista.mode` ↔ `BSC_LISTA_EXECUTE_MODE`
- `bsc.lista.nativeEnabled` ↔ `BSC_LISTA_NATIVE_EXECUTE_ENABLED`
- `bsc.lista.pool` ↔ `BSC_LISTA_POOL`
- `bsc.lista.privateKey` ↔ `BSC_LISTA_EXECUTE_PRIVATE_KEY`
- `bsc.lista.referralCode` ↔ `BSC_LISTA_REFERRAL_CODE`
- `bsc.lista.nativeExecuteCommand` ↔ `BSC_LISTA_NATIVE_EXECUTE_COMMAND` (legacy command-bridge compatibility; not used by native RPC path)
- `bsc.lista.executeCommand` ↔ `BSC_LISTA_EXECUTE_COMMAND`
- `bsc.lista.executeTimeoutMs` ↔ `BSC_LISTA_EXECUTE_TIMEOUT_MS`
- `bsc.lista.maxAmountRaw` ↔ `BSC_LISTA_MAX_AMOUNT_RAW`
- `bsc.lista.allowedTokens` ↔ `BSC_LISTA_ALLOWED_TOKENS`
- `bsc.wombat.enabled` ↔ `BSC_WOMBAT_EXECUTE_ENABLED`
- `bsc.wombat.mode` ↔ `BSC_WOMBAT_EXECUTE_MODE`
- `bsc.wombat.nativeEnabled` ↔ `BSC_WOMBAT_NATIVE_EXECUTE_ENABLED`
- `bsc.wombat.pool` ↔ `BSC_WOMBAT_POOL`
- `bsc.wombat.privateKey` ↔ `BSC_WOMBAT_EXECUTE_PRIVATE_KEY`
- `bsc.wombat.minLiquidityRaw` ↔ `BSC_WOMBAT_MIN_LIQUIDITY_RAW`
- `bsc.wombat.deadlineSeconds` ↔ `BSC_WOMBAT_DEADLINE_SECONDS`
- `bsc.wombat.shouldStake` ↔ `BSC_WOMBAT_SHOULD_STAKE`
- `bsc.wombat.executeCommand` ↔ `BSC_WOMBAT_EXECUTE_COMMAND`
- `bsc.wombat.executeTimeoutMs` ↔ `BSC_WOMBAT_EXECUTE_TIMEOUT_MS`
- `bsc.wombat.maxAmountRaw` ↔ `BSC_WOMBAT_MAX_AMOUNT_RAW`
- `bsc.wombat.allowedTokens` ↔ `BSC_WOMBAT_ALLOWED_TOKENS`
- `bsc.yield.listaAprApiUrl` ↔ `BSC_LISTA_APR_API_URL`
- `bsc.yield.wombatAprApiUrl` ↔ `BSC_WOMBAT_APR_API_URL`
- `bsc.positions.listaRateApiUrl` ↔ `BSC_LISTA_POSITION_RATE_API_URL`
- `bsc.positions.wombatRateApiUrl` ↔ `BSC_WOMBAT_POSITION_RATE_API_URL`
- `bsc.positions.rateCacheTtlMs` ↔ `BSC_POSITION_RATE_CACHE_TTL_MS`
- `bsc.aave.maxAmountRaw` ↔ `BSC_AAVE_MAX_AMOUNT_RAW`
- `alerts.bscNormalizationEnabled` ↔ `NEAR_REBAL_ALERT_BSC_NORMALIZATION`
- `alerts.bscNormalizationMinBand` ↔ `NEAR_REBAL_ALERT_BSC_NORMALIZATION_MIN_BAND`
- `acp.dismissedPurge.enabled` ↔ `ACP_DISMISSED_PURGE_ENABLED`
- `payments.webhookProvider` ↔ `PAYMENT_WEBHOOK_PROVIDER`

## Optional environment variables

- `NEAR_ACCOUNT_ID` - default account loaded in UI (fallback: `davirain8.near`)
- `NEAR_RPC_URL` - single JSON-RPC endpoint
- `NEAR_RPC_URLS` - comma-separated RPC list with automatic 429 fallback (recommended)
- `NEAR_RPC_RETRY_ROUNDS` - extra retry rounds across endpoint list for transient 429/5xx (default: `2`)
- `NEAR_RPC_RETRY_BASE_MS` - backoff base in milliseconds between retry rounds (default: `250`)
- `NEAR_RPC_WARMUP_CALLS` - cold-start rotation call count before score-based routing (default: `max(2, rpcCount*2)`)
- `NEAR_RPC_ALERT_RETRY_RATE` - warn-alert threshold for retry rate (default: `0.2`)
- `NEAR_RPC_ALERT_429_COUNT` - warn-alert threshold for cumulative HTTP 429 count (default: `10`)
- `NEAR_DASHBOARD_PORT` - web port (fallback: `4173`)
- `ACP_BIN` - ACP CLI binary name/path (default: `acp`)
- `ACP_WORKDIR` - working directory to run ACP CLI from (default: current repo root)
- `NEAR_DASHBOARD_METRICS_PATH` - metrics persistence path (default: `apps/dashboard/data/rebalance-metrics.json`)
- `NEAR_DASHBOARD_POLICY_PATH` - policy persistence path (default: `apps/dashboard/data/portfolio-policy.json`)
- `NEAR_DASHBOARD_MARKETPLACE_PATH` - strategy marketplace persistence path (default: `apps/dashboard/data/strategy-marketplace.json`)
- `MONAD_RPC_URL` - Monad RPC endpoint for Morpho read/execute (default: `https://rpc.monad.xyz`)
- `MONAD_CHAIN_ID` - Monad chain id (default: `143`)
- `MONAD_EXECUTE_ENABLED` - enable Monad Morpho execute path (`true|false`, default: `false`)
- `MONAD_EXECUTE_PRIVATE_KEY` - native signer private key for Monad execute
- `MONAD_MORPHO_VAULT` - primary Morpho Earn vault address
- `MONAD_MORPHO_VAULTS` - optional comma-separated vault discovery list (falls back to `MONAD_MORPHO_VAULT`)
- `MONAD_MORPHO_ASSET` - underlying ERC20 asset address
- `MONAD_MORPHO_ASSET_DECIMALS` - asset decimals for display/amount conversion (default: `18`)
- `MONAD_MORPHO_USE_SDK` - enable Morpho SDK adapter branch for markets/strategy (`true|false`, default: `false`)
- `MONAD_MORPHO_SDK_API_BASE_URL` - optional SDK/provider API base URL hint for adapter scaffold
- `MONAD_MORPHO_SDK_PACKAGE` - optional expected official SDK package name hint for telemetry/readiness
- `MONAD_MORPHO_MAX_AMOUNT_RAW` - risk cap for execute amount
- `MONAD_MORPHO_COOLDOWN_SECONDS` - cooldown guard between Monad execute calls (default: `0`, disabled)
- `MONAD_MORPHO_DAILY_CAP_RAW` - optional per-day execute raw amount cap (empty = disabled)
- `MONAD_MORPHO_REWARDS_JSON` - rewards tracking source JSON array for `/api/monad/morpho/earn/rewards` (SDK mode also consumes this scaffold source for normalized rewards rows)
- `MONAD_MORPHO_REWARDS_CLAIM_ENABLED` - enable rewards claim execute endpoint (default: `false`)
- `MONAD_MORPHO_REWARDS_CLAIM_COMMAND` - audited claim command template used by SDK claim-request builder (and native fallback)
- `MONAD_MORPHO_APY_BPS` - APY hint in bps for dashboard display
- `MONAD_MORPHO_RISK_SCORE` - risk score hint (0-100) for dashboard display banding
- `MONAD_MORPHO_LIQUIDITY_CAP_RAW` - optional liquidity cap hint for display
- `MONAD_MORPHO_CONFIRMATIONS` - confirmation count for execute receipt wait (default: `1`)
- `BSC_EXECUTE_ENABLED` - enable BSC execute adapter path (`true|false`, default: `false`)
- `BSC_EXECUTE_MODE` - `auto|native|command` (default: `auto`)
- `BSC_EXECUTE_PRIVATE_KEY` - private key for native BSC executor signer (used by `native`/`auto` mode)
- `BSC_EXECUTE_RECIPIENT` - optional recipient for BSC swap output (default signer address)
- `BSC_EXECUTE_CONFIRMATIONS` - receipt confirmation count for native mode (default: `1`)
- `BSC_EXECUTE_GAS_BUMP_PERCENT` - gas bump percentage over fee data for native mode (default: `15`)
- `BSC_EXECUTE_NONCE_RETRY` - nonce/underpriced retry count for native mode (default: `1`)
- `BSC_QUOTE_MAX_DIVERGENCE_BPS` - max allowed quote divergence between Dexscreener and onchain router (default: `800`)
- `BSC_EXECUTE_COMMAND` - command template for command-mode BSC swap execution (supports placeholders listed above)
- `BSC_YIELD_MIN_APR_DELTA_BPS` - minimum APR delta to trigger APR-driven target override (default: `30`)
- `BSC_YIELD_REBALANCE_INTERVAL_DAYS` - expected rebalance cadence used for net-yield (APR minus swap-cost) annualization in `/api/bsc/yield/markets` (default: `7`)
- `BSC_YIELD_DEFAULT_QUOTE_USD` - default quote notional (USD) used in `/api/bsc/yield/markets` net-yield preview when `amountUsd` query is omitted (default: `100`)
- `BSC_STABLE_APR_HINTS_JSON` - optional Venus APR hints (`{"usdtSupplyAprBps":120,"usdcSupplyAprBps":180,"updatedAt":"..."}`)
- `BSC_AAVE_APR_HINTS_JSON` - optional Aave APR hints (`{"usdtSupplyAprBps":90,"usdcSupplyAprBps":160,"updatedAt":"..."}`)
- `BSC_LISTA_APR_HINTS_JSON` - optional Lista APR hints fallback (read-only compare input; same shape as Aave/Venus hints)
- `BSC_WOMBAT_APR_HINTS_JSON` - optional Wombat APR hints fallback (read-only compare input; same shape as Aave/Venus hints)
- `BSC_LISTA_APR_API_URL` - optional Lista APR API endpoint (preferred over JSON fallback when available)
- `BSC_WOMBAT_APR_API_URL` - optional Wombat APR API endpoint (preferred over JSON fallback when available)
- `BSC_VENUS_APR_API_URL` - optional Venus APR API endpoint (if set, API value has priority over env hints)
- `BSC_AAVE_APR_API_URL` - optional Aave APR API endpoint (if set, API value has priority over env hints)
  - accepted response keys: `usdtSupplyAprBps|usdtAprBps|usdt_supply_apr_bps`, `usdcSupplyAprBps|usdcAprBps|usdc_supply_apr_bps`, optional `updatedAt|timestamp|updated_at`
- `BSC_APR_CACHE_TTL_MS` - APR compare cache TTL (default: `60000`)
- `BSC_AAVE_EXECUTE_ENABLED` - allow BSC yield execute path to proceed when `executionProtocol=aave` (default: `false`, safety-gated)
- `BSC_LISTA_EXECUTE_ENABLED` - gate for Lista execute path (default: `false`)
- `BSC_LISTA_EXECUTE_MODE` - `auto|native|command` (default: `auto`; `native` is in-process ethers RPC execution, `auto` prefers native when enabled+configured and falls back to command)
- `BSC_LISTA_NATIVE_EXECUTE_ENABLED` - gate for Lista native RPC path (default: `false`)
- `BSC_LISTA_POOL` - Lista supply contract/pool address required by native mode
- `BSC_LISTA_EXECUTE_PRIVATE_KEY` - signer private key for Lista native mode (fallback: `BSC_EXECUTE_PRIVATE_KEY`)
- `BSC_LISTA_REFERRAL_CODE` - optional referral code for Lista `supply(asset,amount,onBehalfOf,referralCode)` (default: `0`)
- `BSC_LISTA_NATIVE_EXECUTE_COMMAND` - legacy native-slot command-bridge template (compatibility only; native RPC path does not require this)
- `BSC_LISTA_EXECUTE_COMMAND` - command template for post-swap Lista supply fallback (`{amountRaw} {token} {rpcUrl} {chainId} {runId}`; required placeholders: `{amountRaw}`, `{runId}`)
- `BSC_LISTA_EXECUTE_TIMEOUT_MS` - timeout for Lista command-mode execute (default: `120000`)
- `BSC_LISTA_MAX_AMOUNT_RAW` - max raw amount allowed per Lista supply action (default: `20000000000000000000000`)
- `BSC_LISTA_ALLOWED_TOKENS` - comma-separated token allowlist for Lista supply (default: `${BSC_USDC},${BSC_USDT}`)
- `BSC_WOMBAT_EXECUTE_ENABLED` - gate for Wombat execute path (default: `false`)
- `BSC_WOMBAT_EXECUTE_MODE` - `auto|native|command` (default: `auto`; native path is in-process ethers RPC and `auto` falls back to command when native config is incomplete)
- `BSC_WOMBAT_NATIVE_EXECUTE_ENABLED` - native readiness gate for Wombat execute (default: `false`)
- `BSC_WOMBAT_POOL` - Wombat pool contract address for native `deposit` calls
- `BSC_WOMBAT_EXECUTE_PRIVATE_KEY` - signer private key for Wombat native mode (fallback: `BSC_EXECUTE_PRIVATE_KEY`)
- `BSC_WOMBAT_MIN_LIQUIDITY_RAW` - optional `minimumLiquidity` raw value for native Wombat deposit (default: `0`)
- `BSC_WOMBAT_DEADLINE_SECONDS` - deposit deadline offset seconds for native Wombat deposit (default: `1800`)
- `BSC_WOMBAT_SHOULD_STAKE` - native Wombat deposit `shouldStake` flag (`true|false`, default: `false`)
- `BSC_WOMBAT_EXECUTE_COMMAND` - command template for post-swap Wombat supply (`{amountRaw} {token} {rpcUrl} {chainId} {runId}`; required placeholders: `{amountRaw}`, `{runId}`)
- `BSC_WOMBAT_EXECUTE_TIMEOUT_MS` - timeout for Wombat command-mode execute (default: `120000`)
- `BSC_WOMBAT_MAX_AMOUNT_RAW` - max raw amount allowed per Wombat supply action (default: `20000000000000000000000`)
- `BSC_WOMBAT_ALLOWED_TOKENS` - comma-separated token allowlist for Wombat supply (default: `${BSC_USDC},${BSC_USDT}`)
- `BSC_AAVE_EXECUTE_MODE` - `auto|native|command` (default: `auto`)
- `BSC_AAVE_POOL` - Aave Pool contract address (required for native mode)
- `BSC_AAVE_EXECUTE_PRIVATE_KEY` - signer private key for native Aave supply (fallback: `BSC_EXECUTE_PRIVATE_KEY`)
- `BSC_AAVE_REFERRAL_CODE` - Aave referral code for `supply` (default: `0`)
- `BSC_AAVE_MAX_AMOUNT_RAW` - max raw amount allowed per Aave supply action (default: `20000000000000000000000`)
- `BSC_AAVE_ALLOWED_TOKENS` - comma-separated token allowlist for Aave supply (default: `${BSC_USDC},${BSC_USDT}`)
- `BSC_AAVE_ATOKEN_USDC` - optional Aave aToken address for USDC position read in unified portfolio
- `BSC_AAVE_ATOKEN_USDT` - optional Aave aToken address for USDT position read in unified portfolio
- `BSC_VENUS_VTOKEN_USDC` - optional Venus vToken address for USDC position read in unified portfolio
- `BSC_VENUS_VTOKEN_USDT` - optional Venus vToken address for USDT position read in unified portfolio
- `BSC_LISTA_TOKEN_USDC` - optional Lista position token address for USDC-side position read in unified portfolio
- `BSC_LISTA_TOKEN_USDT` - optional Lista position token address for USDT-side position read in unified portfolio
- `BSC_WOMBAT_TOKEN_USDC` - optional Wombat position token address for USDC-side position read in unified portfolio
- `BSC_WOMBAT_TOKEN_USDT` - optional Wombat position token address for USDT-side position read in unified portfolio
- `BSC_LISTA_USDC_EXCHANGE_RATE` - optional normalization rate from Lista position token to USDC underlying (default `1`)
- `BSC_LISTA_USDT_EXCHANGE_RATE` - optional normalization rate from Lista position token to USDT underlying (default `1`)
- `BSC_WOMBAT_USDC_EXCHANGE_RATE` - optional normalization rate from Wombat position token to USDC underlying (default `1`)
- `BSC_WOMBAT_USDT_EXCHANGE_RATE` - optional normalization rate from Wombat position token to USDT underlying (default `1`)
- `BSC_LISTA_POSITION_RATE_API_URL` - optional Lista normalization-rate API endpoint (preferred over static rates when available)
- `BSC_WOMBAT_POSITION_RATE_API_URL` - optional Wombat normalization-rate API endpoint (preferred over static rates when available)
- `BSC_POSITION_RATE_CACHE_TTL_MS` - cache TTL for Lista/Wombat normalization-rate API fetches (default `60000`)
- `BSC_AAVE_EXECUTE_COMMAND` - command template for optional post-swap Aave supply action in aave execution mode (`{amountRaw} {token} {rpcUrl} {chainId} {runId}`)
  - required placeholders: `{amountRaw}`, `{runId}` (missing placeholders block execution)
- `BSC_YIELD_EXECUTION_PROTOCOL_DEFAULT` - default execution protocol for BSC yield plan/worker (`venus|aave|lista|wombat`, default: `venus`)
- Worker runtime options (request payload, not env): `dryRun`, `intervalMs`, `targetUsdcBps`, `minDriftBps`, `minAprDeltaBps`, `maxStepUsd`
- `ACP_DISMISSED_PURGE_ENABLED` - enable automatic dismissed-archive purge scheduler (`true|false`, default: `false`)
- `ACP_DISMISSED_PURGE_DAYS` - purge threshold in days for dismissed jobs (default: `7`)
- `ACP_DISMISSED_PURGE_INTERVAL_MS` - purge scheduler interval in milliseconds (default: `21600000` = 6h)
- `PAYMENT_WEBHOOK_SECRET` - optional HMAC secret for `/api/payments/webhook` signature verification (`sha256=<hex>`)
- `PAYMENT_WEBHOOK_PROVIDER` - default webhook provider schema (`generic|ping|x402`, default `generic`)

Example:

```bash
NEAR_ACCOUNT_ID=davirain8.near NEAR_RPC_URL=https://1rpc.io/near npm run dashboard:start
```

## Notes

- This dashboard is read-only and intended for monitoring.
- For strategy execution, continue using OpenClaw tools/workflows with explicit confirmations.
- If RPC returns `429 Too Many Requests`, switch to a less congested endpoint via `NEAR_RPC_URL`.
