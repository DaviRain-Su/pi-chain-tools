{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/DaviRain-Su/pi-chain-tools/blob/main/docs/schemas/openclaw-btc5m-workflow.schema.json",
  "title": "OpenClaw BTC5m Workflow",
  "type": "object",
  "required": ["version", "workflow"],
  "additionalProperties": false,
  "properties": {
    "version": {
      "const": "1.0"
    },
    "workflow": {
      "type": "object",
      "required": ["id", "description", "startAt", "input", "states"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "startAt": {
          "type": "string",
          "minLength": 1
        },
        "input": {
          "$ref": "#/$defs/WorkflowInput"
        },
        "states": {
          "type": "object",
          "minProperties": 1,
          "patternProperties": {
            "^[A-Za-z_][A-Za-z0-9_]*$": {
              "$ref": "#/$defs/State"
            }
          },
          "additionalProperties": false
        },
        "finalState": {
          "type": "string",
          "minLength": 1
        }
      }
    }
  },
  "$defs": {
    "WorkflowInput": {
      "type": "object",
      "required": ["runId", "network", "intentType", "stakeUsd"],
      "additionalProperties": false,
      "properties": {
        "runId": {
          "type": "string",
          "pattern": "^[A-Za-z0-9_\\-]+$"
        },
        "network": {
          "type": "string",
          "enum": ["base", "polygon", "arbitrum", "optimism", "bsc", "ethereum", "other"]
        },
        "intentType": {
          "type": "string",
          "enum": [
            "evm.polymarket.btc5m.trade",
            "evm.polymarket.btc5m.cancel",
            "evm.transfer.native",
            "evm.transfer.erc20"
          ]
        },
        "side": {
          "type": "string",
          "enum": ["up", "down"]
        },
        "stakeUsd": {
          "type": "number",
          "minimum": 0.01
        },
        "maxSpreadBps": {
          "type": "number",
          "minimum": 0.01
        },
        "minDepthUsd": {
          "type": "number",
          "minimum": 0.01
        },
        "maxStakeUsd": {
          "type": "number",
          "minimum": 0.01
        },
        "minConfidence": {
          "type": "number",
          "minimum": 0.01,
          "maximum": 0.99
        },
        "marketSlug": {
          "type": "string"
        },
        "settleAfterTrade": {
          "type": "boolean"
        },
        "settleMaxAgeMinutes": {
          "type": "number",
          "minimum": 0.1
        },
        "settleMaxFillRatio": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "cancelOnDemand": {
          "type": "boolean"
        },
        "maxFillRatio": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "maxAgeMinutes": {
          "type": "number",
          "minimum": 0.1
        }
      }
    },
    "State": {
      "oneOf": [
        {
          "$ref": "#/$defs/ToolState"
        },
        {
          "$ref": "#/$defs/ConditionState"
        },
        {
          "$ref": "#/$defs/ManualState"
        },
        {
          "$ref": "#/$defs/TerminalState"
        }
      ]
    },
    "ToolState": {
      "type": "object",
      "required": ["type", "tool", "params"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "tool"
        },
        "tool": {
          "type": "string",
          "minLength": 1
        },
        "params": {
          "type": "object",
          "additionalProperties": true
        },
        "onSuccess": {
          "$ref": "#/$defs/Transition"
        },
        "onFailure": {
          "$ref": "#/$defs/Transition"
        },
        "guard": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "ConditionState": {
      "type": "object",
      "required": ["type", "expression", "onTrue", "onFalse"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "condition"
        },
        "expression": {
          "type": "string",
          "minLength": 1
        },
        "onTrue": {
          "$ref": "#/$defs/TransitionState"
        },
        "onFalse": {
          "$ref": "#/$defs/TransitionState"
        }
      }
    },
    "ManualState": {
      "type": "object",
      "required": ["type", "needOperator"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "manual"
        },
        "needOperator": {
          "const": true
        },
        "message": {
          "type": "string"
        },
        "notify": {
          "type": ["string", "null"]
        },
        "onFailure": {
          "$ref": "#/$defs/Transition"
        },
        "onSuccess": {
          "$ref": "#/$defs/Transition"
        },
        "assign": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "TerminalState": {
      "type": "object",
      "required": ["type", "result"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "terminal"
        },
        "result": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "Transition": {
      "type": "object",
      "required": ["to"],
      "additionalProperties": false,
      "properties": {
        "to": {
          "type": "string",
          "minLength": 1
        },
        "error": {
          "type": "string"
        },
        "if": {
          "type": "string"
        },
        "assign": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "TransitionState": {
      "type": "object",
      "required": ["to"],
      "additionalProperties": false,
      "properties": {
        "to": {
          "type": "string",
          "minLength": 1
        }
      }
    }
  }
}
