{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "https://pi-chain-tools/schemas/strategy-spec.v0.schema.json",
	"title": "PI Chain Tools Strategy Spec v0",
	"type": "object",
	"additionalProperties": false,
	"required": [
		"id",
		"name",
		"version",
		"owner",
		"goal",
		"constraints",
		"triggers",
		"plan"
	],
	"properties": {
		"id": { "type": "string", "minLength": 1 },
		"name": { "type": "string", "minLength": 1 },
		"version": { "type": "string", "pattern": "^v?\\d+\\.\\d+(\\.\\d+)?$" },
		"owner": {
			"type": "object",
			"additionalProperties": false,
			"required": ["namespace", "author"],
			"properties": {
				"namespace": { "type": "string", "minLength": 1 },
				"author": { "type": "string", "minLength": 1 }
			}
		},
		"goal": {
			"type": "object",
			"additionalProperties": false,
			"required": ["kind", "description"],
			"properties": {
				"kind": {
					"type": "string",
					"enum": ["rebalance", "yield", "hedge", "bridge", "custom"]
				},
				"description": { "type": "string", "minLength": 1 },
				"kpis": {
					"type": "array",
					"items": {
						"type": "object",
						"additionalProperties": false,
						"required": ["name", "target"],
						"properties": {
							"name": { "type": "string", "minLength": 1 },
							"target": { "type": ["string", "number", "boolean"] },
							"unit": { "type": "string" }
						}
					}
				}
			}
		},
		"constraints": {
			"type": "object",
			"additionalProperties": false,
			"required": ["risk", "allow"],
			"properties": {
				"risk": {
					"type": "object",
					"additionalProperties": false,
					"required": ["maxPerRunUsd", "maxSlippageBps", "maxDailyRuns"],
					"properties": {
						"maxPerRunUsd": { "type": "number", "exclusiveMinimum": 0 },
						"maxSlippageBps": {
							"type": "integer",
							"minimum": 1,
							"maximum": 1000
						},
						"maxDailyRuns": { "type": "integer", "minimum": 1, "maximum": 500 }
					}
				},
				"allow": {
					"type": "object",
					"additionalProperties": false,
					"required": ["chains", "protocols"],
					"properties": {
						"chains": {
							"type": "array",
							"minItems": 1,
							"items": { "type": "string", "minLength": 1 }
						},
						"protocols": {
							"type": "array",
							"minItems": 1,
							"items": { "type": "string", "minLength": 1 }
						},
						"assets": {
							"type": "array",
							"items": { "type": "string", "minLength": 1 }
						}
					}
				}
			}
		},
		"triggers": {
			"type": "array",
			"minItems": 1,
			"items": {
				"type": "object",
				"additionalProperties": false,
				"required": ["type"],
				"properties": {
					"type": {
						"type": "string",
						"enum": ["cron", "threshold", "manual", "event"]
					},
					"cron": { "type": "string" },
					"condition": { "type": "string" }
				}
			}
		},
		"plan": {
			"type": "object",
			"additionalProperties": false,
			"required": ["steps"],
			"properties": {
				"steps": {
					"type": "array",
					"minItems": 1,
					"items": {
						"type": "object",
						"additionalProperties": false,
						"required": ["id", "action", "component"],
						"properties": {
							"id": { "type": "string", "minLength": 1 },
							"action": { "type": "string", "minLength": 1 },
							"component": { "type": "string", "minLength": 1 },
							"params": { "type": "object", "additionalProperties": true },
							"onFailure": {
								"type": "string",
								"enum": ["abort", "retry", "fallback"]
							}
						}
					}
				}
			}
		},
		"metadata": {
			"type": "object",
			"additionalProperties": true
		}
	}
}
